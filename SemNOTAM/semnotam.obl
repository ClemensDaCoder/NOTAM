// --------------------------------------------------------------------
//
//  ontology: <http://www.dke.jku.at/semnotam>
//      date: 2013-12-31 15:59:21
//
//  created with OntoStudio 3.2.0-B353
// ---------------------------------------------------------------------

:- version("2.1").
:- encoding("Cp1252").

:- default prefix = "http://www.dke.jku.at/semnotam#".
:- prefix orn = "http://schema.ontoprise.com/reserved#".
:- prefix xsd = "http://www.w3.org/2001/XMLSchema#".
:- module = <http://www.dke.jku.at/semnotam>.


// Concept hierarchy ------------------------------------

integer[].
Waypoint[].
ValidTime[].
Runway[].
Point[].
Notam[].
NotamFlight[].
Importance[].
Flight[].
Feature[].
CurrentFlightPhase[].
Area[].
ApplyTime[].
Aircraft[].

UnspecifiedAircraft::Aircraft.
SNOWTAM::Notam.
Route::Feature.
NavaidUnservicable::Notam.
Nav::Feature.
BIRDTAM::Notam.
AirportPartialClosure::AirportClosure.
AirportFullClosure::AirportClosure.
AirportClosure::Notam.
Airport::Feature.
AircraftType::Feature.

// Schema -----------------------------------------------

Waypoint[relativeDuration {1:1} *=> _duration].
Waypoint[hasPoint {1:1} *=> Point].
ValidTime[validTo {1:1} *=> _dateTime].
ValidTime[validFrom {1:1} *=> _dateTime].
SNOWTAM[aboveWingspanClosed {1:1} *=> _integer].
Runway[runway {1:1} *=> _string].
Route[hasWaypoint {1:*} *=> Waypoint].
Route[flightTo {1:1} *=> Airport].
Route[flightFrom {1:1} *=> Airport].
Point[hasY {1:1} *=> _integer].
Point[hasX {1:1} *=> _integer].
Notam[relevantForWaypoint {0:*} *=> Waypoint].
Notam[relevantForTakeoff {0:*} *=> Flight].
Notam[relevantForLanding {0:*} *=> Flight].
Notam[relevantForFlightRoute {0:*} *=> Route].
Notam[relevantForFlight {0:*} *=> Flight].
Notam[relevantForAircraft {0:*} *=> Aircraft].
Notam[notamText {1:1} *=> _string].
Notam[name {1:1} *=> _string].
Notam[isConsequenceOf {0:*,inverseOf(hasFollowingNotam),transitive} *=> Notam].
Notam[hasValidTime {1:1} *=> ValidTime].
Notam[hasFollowingNotam {0:*,transitive} *=> Notam].
Notam[hasApplyTime {1:1} *=> ApplyTime].
Notam[concernsAirspace {0:1} *=> Area].
Notam[concernsAirport {0:*} *=> Airport].
Notam[belongsTo {0:*,inverseOf(describedByNotam)} *=> Feature].
NotamFlight[hasNotam {1:1} *=> Notam].
NotamFlight[hasImportance {1:1} *=> Importance].
NotamFlight[hasFlight {1:1} *=> Flight].
NotamFlight[flightPhase {1:1} *=> CurrentFlightPhase].
NavaidUnservicable[concernsNavequip {1:1} *=> Nav].
Nav[navAid {1:1} *=> _string].
Flight[name {1:1} *=> _string].
Flight[hasRoute {1:1} *=> Route].
Flight[hasCurrentLocation {1:1} *=> Point].
Flight[hasAircraft {1:1} *=> Aircraft].
Flight[elapsedTime {1:1} *=> _integer].
Flight[deptTime {1:1} *=> _dateTime].
Flight[arrivalTime {1:1} *=> _dateTime].
Feature[describedByNotam {0:*} *=> Notam].
Area[width {1:1} *=> _integer].
Area[height {1:1} *=> _integer].
Area[hasPoint {1:1} *=> Point].
ApplyTime[appliesTo {1:1} *=> _time].
ApplyTime[appliesFrom {1:1} *=> _time].
Airport[name {1:1} *=> _string].
Airport[hasRunways {1:*} *=> Runway].
Airport[hasPoint {1:1} *=> Point].
AirportPartialClosure[hasClosedRunway {1:*} *=> Runway].
AirportPartialClosure[aboveWingspanClosed {1:1} *=> integer].
Aircraft[hasAircraftType {0:1} *=> AircraftType].
AircraftType[wingspan {1:1} *=> _integer].
AircraftType[name {1:1} *=> _string].
AircraftType[hasNavAid {0:*} *=> Nav].

// Instances --------------------------------------------

ValidNovember2013:ValidTime.
navGPS:Nav.
W7:Waypoint.
W6:Waypoint.
W5:Waypoint.
W4:Waypoint.
W3:Waypoint.
W2:Waypoint.
W1:Waypoint.
ValidDecember2013:ValidTime.
UFO:UnspecifiedAircraft.
Taxi:CurrentFlightPhase.
Takeoff:CurrentFlightPhase.
Sailplane:Aircraft.
SNOWTAM1:SNOWTAM.
R3:Route.
R2:Route.
R1:Route.
PreFlight:CurrentFlightPhase.
P78:Point.
P66:Point.
P63:Point.
P51:Point.
P512:Point.
P44:Point.
P204:Point.
P192:Point.
P1911:Point.
P162:Point.
P1511:Point.
P146:Point.
P11:Point.
P102:Point.
Notam1:Notam.
NavidUnservicable1:NavaidUnservicable.
Landing:CurrentFlightPhase.
Jumbo:Aircraft.
Glider:AircraftType.
FlightA3A5:Flight.
FlightA1A2:Flight.
Fligh:CurrentFlightPhase.
BIRDTAM1:BIRDTAM.
Approach:CurrentFlightPhase.
Apply5To9:ApplyTime.
Apply24Hours:ApplyTime.
Apply10To11:ApplyTime.
AirportFullClosure1:AirportFullClosure.
AirbusA380:AircraftType.
AREA2:Area.
AREA1:Area.
A5:Airport.
A4:Airport.
A3:Airport.
A2:Airport.
A1:Airport.

// Properties -------------------------------------------

ValidNovember2013[validTo->"2013-11-30T23:59:59"^^_dateTime].
ValidNovember2013[validFrom->"2013-11-01T00:00:00"^^_dateTime].
navGPS[navAid->"GPS"].
W7[relativeDuration->"P0Y0M0DT0H30M0S"^^_duration].
W7[hasPoint->P192].
W6[hasPoint->P1511].
W5[hasPoint->P146].
W4[hasPoint->P102].
W3[hasPoint->P63].
W2[relativeDuration->"P0Y0M0DT0H0M40S"^^_duration].
W2[hasPoint->P78].
W1[relativeDuration->"P0Y0M0DT0H0M20S"^^_duration].
W1[hasPoint->P44].
ValidDecember2013[validTo->"2013-12-31T23:59:59"^^_dateTime].
ValidDecember2013[validFrom->"2013-12-01T00:00:00"^^_dateTime].
Sailplane[hasAircraftType->Glider].
SNOWTAM1[name->"SNOWTAM1"].
SNOWTAM1[hasValidTime->ValidDecember2013].
SNOWTAM1[hasApplyTime->Apply24Hours].
SNOWTAM1[concernsAirspace->AREA1].
SNOWTAM1[aboveWingspanClosed->20].
R3[hasWaypoint->W7].
R3[flightTo->A5].
R3[flightFrom->A3].
R2[hasWaypoint->W6].
R2[hasWaypoint->W5].
R2[hasWaypoint->W4].
R2[hasWaypoint->W3].
R2[flightTo->A4].
R2[flightFrom->A2].
R1[hasWaypoint->W2].
R1[hasWaypoint->W1].
R1[flightTo->A2].
R1[flightFrom->A1].
P78[hasY->8].
P78[hasX->7].
P66[hasY->6].
P66[hasX->6].
P63[hasY->3].
P63[hasX->6].
P51[hasY->1].
P51[hasX->5].
P512[hasY->12].
P512[hasX->5].
P44[hasY->4].
P44[hasX->4].
P204[hasY->4].
P204[hasX->20].
P192[hasY->2].
P192[hasX->19].
P1911[hasY->11].
P1911[hasX->19].
P162[hasY->2].
P162[hasX->16].
P1511[hasY->11].
P1511[hasX->15].
P146[hasY->6].
P146[hasX->14].
P11[hasY->1].
P11[hasX->1].
P102[hasY->2].
P102[hasX->10].
Notam1[name->"Notam1"].
Notam1[concernsAirspace->AREA2].
NavidUnservicable1[name->"NavidUnservicable1"].
NavidUnservicable1[hasValidTime->ValidDecember2013].
NavidUnservicable1[hasApplyTime->Apply10To11].
NavidUnservicable1[concernsNavequip->navGPS].
NavidUnservicable1[concernsAirspace->AREA1].
Jumbo[hasAircraftType->AirbusA380].
Glider[wingspan->12].
Glider[name->"Glider"].
FlightA3A5[name->"FlightA3A5"].
FlightA3A5[hasRoute->R3].
FlightA3A5[hasAircraft->Sailplane].
FlightA3A5[deptTime->"2013-12-30T06:00:00"^^_dateTime].
FlightA3A5[arrivalTime->"2013-12-30T07:00:00"^^_dateTime].
FlightA1A2[name->"FlightA1A2"].
FlightA1A2[hasRoute->R1].
FlightA1A2[hasAircraft->Jumbo].
FlightA1A2[deptTime->"2013-12-30T02:01:00"^^_dateTime].
FlightA1A2[arrivalTime->"2013-12-30T02:00:00"^^_dateTime].
BIRDTAM1[name->"BIRDTAM1"].
BIRDTAM1[hasValidTime->ValidDecember2013].
BIRDTAM1[concernsAirspace->AREA2].
Apply5To9[appliesTo->"09:00:00"^^_time].
Apply5To9[appliesFrom->"05:00:00"^^_time].
Apply24Hours[appliesTo->"23:59:59"^^_time].
Apply24Hours[appliesFrom->"00:00:00"^^_time].
Apply10To11[appliesTo->"11:00:00"^^_time].
Apply10To11[appliesFrom->"10:00:00"^^_time].
AirportFullClosure1[name->"AirportFullClosure1"].
AirportFullClosure1[hasValidTime->ValidDecember2013].
AirportFullClosure1[hasApplyTime->Apply5To9].
AirportFullClosure1[concernsAirport->A3].
AirbusA380[wingspan->80].
AirbusA380[name->"AirbusA380"].
AirbusA380[hasNavAid->navGPS].
AREA2[width->16].
AREA2[height->2].
AREA2[hasPoint->P51].
AREA1[width->4].
AREA1[height->3].
AREA1[hasPoint->P66].
A5[name->"A5"].
A4[name->"A4"].
A4[hasPoint->P1911].
A3[name->"A3"].
A3[hasPoint->P162].
A2[name->"A2"].
A2[hasPoint->P11].
A1[name->"A1"].
A1[hasPoint->P512].
BIRDTAM1[hasApplyTime->Apply10To11].
A5[hasPoint->P204].

// Misc. Facts ------------------------------------------

crosses(Point,Area).
_rulecategory(ruleRelevantForTakeoff,_path("Rules")).
_rulecategory(ruleRelevantForLanding,_path("Rules")).
_rulecategory(ruleRelevantForFlightRoute,_path("Rules")).
_rulecategory(ruleRelevantForFlightFlightRoute,_path("Rules")).
_rulecategory(ruleRelevantForFlightLandingTakeoff,_path("Rules")).

// Rules ------------------------------------------------

@{ruleConcernsAirportGeneral} 
?N[concernsAirport->?A]
:-
(?N:BIRDTAM OR ?N:NavaidUnservicable)
AND ?N[concernsAirspace->?AS] AND
?A:Airport[hasPoint->?P] AND
crosses(?P,
?AS).

@{ruleCrosses} 
crosses(?P1,
?A)
:-
?P1:Point[hasX->?X1,hasY->?Y1] AND
?A:Area[hasPoint->?PA,
height->?H,
width->?W]
AND
?PA:Point[hasX->?X2,
hasY->?Y2] AND 
_greaterOrEquals(?X1, ?X2) AND
_lessOrEquals(?X1, (?X2 + ?W)) AND
_greaterOrEquals(?Y1, ?Y2) AND
_lessOrEquals(?Y1, (?Y2+?H)).

@{ruleRelevantForAircraftAirportFullClosure} 
?N[relevantForAircraft->?A]
:-
?N:AirportFullClosure AND
?A:Aircraft.

@{ruleRelevantForAircraftAirportPartialClosure} 
?N[relevantForAircraft->?A]
:-
?N:AirportPartialClosure[aboveWingspanClosed->?WSC] AND
?A:Aircraft[hasAircraftType->?AT]
AND
?AT:AircraftType[wingspan->?WS] AND
?WS > ?WSC.

@{ruleRelevantForAircraftBIRDTAM} 
?N[relevantForAircraft->?A]
:-
?N:BIRDTAM AND
?A:Aircraft.

@{ruleRelevantForAircraftNavaidUnservicable} 
?N[relevantForAircraft->?A]
:-
?N:NavaidUnservicable[concernsNavequip->?NAV] AND
?NAV:Nav AND
?AT:AircraftType[hasNavAid->?NAV] AND
?A:Aircraft[hasAircraftType->?AT].

@{ruleRelevantForAircraftSNOWTAM} 
?N[relevantForAircraft->?A]
:-
?N:SNOWTAM[aboveWingspanClosed->?WSC] AND
?A:Aircraft[hasAircraftType->?AT]
AND
?AT:AircraftType[wingspan->?WS] AND
?WS > ?WSC.

@{ruleRelevantForFlightRoute} 
?N[relevantForFlightRoute->?R] :-
?N:Notam[relevantForWaypoint->?WP]
AND _equals(?WP, ?W) AND
_equals(true, ?V) AND
_memberByPath(?Result,_path("notamValid"), ?V) AND
_webserviceAccess([_wsdl->"http://localhost:8080/NotamForWaypointRPCLiteralCXF/services/NotamForWaypoint_Port?wsdl",
_service->"NotamForWaypoint_PortType",
_method->"notamValidForWaypoint",
_port->"NotamForWaypoint_Port"],
["flightDepartureTime"->?DT,
"waypointRelativeDuration"->?DUR,
"notamValidFrom"->?VTF,
"notamValidTo"->?VTT,
"notamApplyFrom"->?ATF,
"notamApplyTo"->?ATT],?Result)
AND ?F:Flight[deptTime->?DT, hasRoute->?R]
AND ?R[hasWaypoint->?W]
AND ?W[relativeDuration->?DUR]
AND ?N[hasValidTime->?VT, hasApplyTime->?AT]
AND ?VT[validFrom->?VTF, validTo->?VTT]
AND ?AT[appliesFrom->?ATF, appliesTo->?ATT].

@{ruleRelevantForLanding} 
?N[relevantForLanding->?F]
:-
?N:Notam[concernsAirport->?A] AND
?F:Flight[hasRoute->?R] AND
?R[flightTo->?A] AND
_equals(true, ?V) AND
_memberByPath(?Result,_path("notamValid"), ?V) AND
_webserviceAccess([_wsdl->"http://localhost:8080/NotamForWaypointRPCLiteralCXF/services/NotamForWaypoint_Port?wsdl",
_service->"NotamForWaypoint_PortType",
_method->"notamValidForWaypoint",
_port->"NotamForWaypoint_Port"],
["flightDepartureTime"->?ART,
"waypointRelativeDuration"->"P0Y0M0DT0H0M00S",
"notamValidFrom"->?VTF,
"notamValidTo"->?VTT,
"notamApplyFrom"->?ATF,
"notamApplyTo"->?ATT],?Result)
AND ?F:Flight[arrivalTime->?ART]
AND ?N[hasValidTime->?VT, hasApplyTime->?AT]
AND ?VT[validFrom->?VTF, validTo->?VTT]
AND ?AT[appliesFrom->?ATF, appliesTo->?ATT].

@{ruleRelevantForTakeoff} 
?N[relevantForTakeoff->?F]
:-
?N:Notam[concernsAirport->?A] AND
?F:Flight[hasRoute->?R] AND
?R[flightFrom->?A] AND
_equals(true, ?V) AND
_memberByPath(?Result,_path("notamValid"), ?V) AND
_webserviceAccess([_wsdl->"http://localhost:8080/NotamForWaypointRPCLiteralCXF/services/NotamForWaypoint_Port?wsdl",
_service->"NotamForWaypoint_PortType",
_method->"notamValidForWaypoint",
_port->"NotamForWaypoint_Port"],
["flightDepartureTime"->?DT,
"waypointRelativeDuration"->"P0Y0M0DT0H0M00S",
"notamValidFrom"->?VTF,
"notamValidTo"->?VTT,
"notamApplyFrom"->?ATF,
"notamApplyTo"->?ATT],?Result)
AND ?F:Flight[deptTime->?DT]
AND ?N[hasValidTime->?VT, hasApplyTime->?AT]
AND ?VT[validFrom->?VTF, validTo->?VTT]
AND ?AT[appliesFrom->?ATF, appliesTo->?ATT].

@{ruleRelevantForUnspecifiedAircraft} 
?N[relevantForAircraft->?A]
:-
?A:UnspecifiedAircraft
AND ?N:Notam.

@{ruleRelevantForWaypoint} 
?N[relevantForWaypoint->
?WP]
:-
?N:Notam[concernsAirspace->?A] AND
?WP:Waypoint[hasPoint->?P] AND
crosses(?P,
?A).

@{ruleRelevantForFlightFlightRoute} 
?N[relevantForFlight->?F]
:-
?N:Notam[relevantForFlightRoute->?R, relevantForAircraft->?A]
AND ?F:Flight[hasAircraft->?A, hasRoute->?R]
AND ?R:Route AND ?A:Aircraft.

@{ruleRelevantForFlightLandingTakeoff} 
?N[relevantForFlight->?F]
:-
(?N:Notam[relevantForTakeoff->?F] OR ?N[relevantForLanding->?F]) AND
?F[hasAircraft->?A] AND
?N[relevantForAircraft->?A].


// Queries ----------------------------------------------

@{queryRelevantForAircraft} 
?- ?N:Notam[relevantForAircraft->?A].

@{queryRelevantForAirport} 
?- ?N:Notam[concernsAirport->?A].

@{queryRelevantForFlightRoute} 
?- ?N:Notam[relevantForFlightRoute->?FR].

@{queryRelevantForFlight} 
?- ?N:Notam[relevantForFlight->?F].

@{queryRelevantForLanding} 
?- ?N:Notam[relevantForLanding->?F].

@{queryRelevantForTakeoff} 
?- ?N:Notam[relevantForTakeoff->?F].

@{queryRelevantForWaypoint} 
?- ?N:Notam[relevantForWaypoint-> W3].

@{queryTestWebservice} 
?-
_memberByPath(?Result,_path("notamValid"), ?V) AND
_webserviceAccess([_wsdl->"http://localhost:8080/NotamForWaypoint/services/NotamForWaypoint_Port?wsdl",
_service->"NotamForWaypoint_PortType",
_method->"notamValidForWaypoint",
_port->"NotamForWaypoint_Port"],
["flightDepartureTime"->?DT,
"waypointRelativeDuration"->?DUR,
"notamValidFrom"->?VTF,
"notamValidTo"->?VTT,
"notamApplyFrom"->?ATF,
"notamApplyTo"->?ATT],?Result)
AND FlightA1A2[deptTime->?DT, hasRoute->?R]
AND ?R[hasWaypoint->?W]
AND ?W[relativeDuration->?DUR]
AND SNOWTAM1[hasValidTime->?VT, hasApplyTime->?AT]
AND ?VT[validFrom->?VTF, validTo->?VTT]
AND ?AT[appliesFrom->?ATF, appliesTo->?ATT].

